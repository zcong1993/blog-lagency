---
title: 简单的注册验证
date: "2016-05-11"
layout: post
path: "/article4/"
categories:
  - PHP
  - 扯淡
---

这两天写了个简单的文章分享页面，但是不是随随便便的分享，用户可以随意观看，但是发文章需要注册为会员。于是申请了个企业免费邮箱，做了个邮件注册验证。

这个原理非常简单，和验证码原理基本一样。用户注册请求时，服务器调用 PHPMailer 向用户发送邮件，这个邮件内容为服务器生成的一个唯一的 token，我用的是用户名 MD5 加密和一个随机的数字的 MD5 加密拼接的字符串，将这个字符串放在验证 url 的参数中。同时服务器也会将生成的 token 放在 session 中，我还定义了一个有效时间。

<!--more-->

验证时，也就是用户请求这个 url，服务器会先判断当前时间是否过了有效期，如果在有效期内，则 get 到这个 token 和 session 保存的进行对比，成功则验证成功，失败则失败。

突然想到了一个漏洞。我做的这个过于简单，单纯的进行 session 验证，导致一个非常严重的问题，就是用户必须保证同一个会话中才能验证成功，因为每个会话对用一个 session。所以，如果你在电脑上注册账号，在手机端验证，肯定会失败，反之亦然。

这个问题我会继续思考的。用数据库很简单就会实现，这个问题确实是疏忽大意。
